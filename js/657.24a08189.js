"use strict";(self["webpackChunktoutiao_m"]=self["webpackChunktoutiao_m"]||[]).push([[657],{3657:function(t,e,o){o.r(e),o.d(e,{default:function(){return X}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"article-container"},[e("van-nav-bar",{attrs:{"left-arrow":"",title:"黑马头条",fixed:""},on:{"click-left":function(e){return t.$router.back()}}}),e("div",{staticClass:"main-wrap"},[t.loading?e("div",{staticClass:"loading-wrap"},[e("van-loading",{attrs:{color:"#1989fa",vertical:""}},[t._v("加载中")])],1):t.article.title?e("div",{staticClass:"article-detail"},[e("h1",{staticClass:"article-title"},[t._v(t._s(t.article.title))]),e("van-cell",{staticClass:"user-info",scopedSlots:t._u([{key:"icon",fn:function(){return[e("van-image",{staticClass:"avatar",attrs:{fit:"cover",round:"",src:t.article.aut_photo}})]},proxy:!0},{key:"title",fn:function(){return[e("div",{staticClass:"user-name"},[t._v(t._s(t.article.aut_name))])]},proxy:!0},{key:"label",fn:function(){return[e("div",{staticClass:"publish-date"},[t._v(t._s(t._f("relativeTime")(t.article.pubdate)))])]},proxy:!0},{key:"right-icon",fn:function(){return[e("follow-user",{attrs:{userId:t.article.aut_id,isFollowed:t.article.is_followed},on:{"update:isFollowed":function(e){return t.$set(t.article,"is_followed",e)},"update:is-followed":function(e){return t.$set(t.article,"is_followed",e)}}})]},proxy:!0}])}),e("div",{ref:"article-content",staticClass:"article-content markdown-body",domProps:{innerHTML:t._s(t.article.content)}}),e("van-divider",[t._v("正文结束")]),e("comment-list",{ref:"comment-list",attrs:{targetId:t.articleId,totalCount:t.totalCommentCount},on:{"update:totalCount":function(e){t.totalCommentCount=e},"update:total-count":function(e){t.totalCommentCount=e},"reply-click":t.onReplyClick}})],1):404===t.errStatus?e("div",{staticClass:"error-wrap"},[e("van-icon",{attrs:{name:"failure"}}),e("p",{staticClass:"text"},[t._v("该资源不存在或已删除！")])],1):e("div",{staticClass:"error-wrap"},[e("van-icon",{attrs:{name:"failure"}}),e("p",{staticClass:"text"},[t._v("内容加载失败！")]),e("van-button",{staticClass:"retry-btn",on:{click:t.loadArticleInfo}},[t._v("点击重试")])],1)]),e("div",{staticClass:"article-bottom"},[e("van-button",{staticClass:"comment-btn",attrs:{type:"default",round:"",size:"small"},on:{click:function(e){t.isPostShow=!0}}},[t._v("写评论")]),e("van-icon",{attrs:{name:"comment-o",badge:t.totalCommentCount}}),e("collect-article",{attrs:{articleId:t.article.art_id},model:{value:t.article.is_collected,callback:function(e){t.$set(t.article,"is_collected",e)},expression:"article.is_collected"}}),e("like-article",{attrs:{articleId:t.article.art_id,attitude:t.article.attitude},on:{"update:attitude":function(e){return t.$set(t.article,"attitude",e)}}})],1),e("van-popup",{attrs:{position:"bottom"},model:{value:t.isPostShow,callback:function(e){t.isPostShow=e},expression:"isPostShow"}},[e("comment-post",{attrs:{targetId:t.article.aut_id},on:{"post-success":t.onPostSuccess}})],1),e("van-popup",{style:{height:"100%"},attrs:{position:"bottom"},model:{value:t.isReplyShow,callback:function(e){t.isReplyShow=e},expression:"isReplyShow"}},[t.isReplyShow?e("comment-reply",{attrs:{comment:t.currentComment},on:{close:function(e){t.isReplyShow=!1}}}):t._e()],1)],1)},n=[],i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"comment-post"},[e("van-field",{staticClass:"post-field",attrs:{rows:"2",autosize:"",type:"textarea",maxlength:"50",placeholder:"优质评论优先显示","show-word-limit":""},model:{value:t.message,callback:function(e){t.message="string"===typeof e?e.trim():e},expression:"message"}}),e("van-button",{staticClass:"post-btn",attrs:{size:"small",disabled:!t.message.length},on:{click:t.onAddComment}},[t._v("发布 ")])],1)},a=[],l=o(432),c={name:"CommentPost",props:{targetId:{type:String,default:""},articleId:{type:String,default:""}},data(){return{message:""}},methods:{async onAddComment(){try{const t=this.message.trim();if(!t.length)return;const{data:e}=await(0,l.AD)({target:this.targetId,content:this.message,art_id:this.articleId||null});console.log(e),this.message="",this.$emit("post-success",e.data),this.$toast.success("发布成功")}catch(t){this.$toast.fail("发布失败")}}}},r=c,m=o(1001),u=(0,m.Z)(r,i,a,!1,null,"1b018305",null),d=u.exports,p=function(){var t=this,e=t._self._c;return e("div",{staticClass:"comment-list"},[e("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了",error:t.error,"error-text":"请求失败，点击重新加载"},on:{load:t.onLoad,"update:error":function(e){t.error=e}},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(o,s){return e("comment-item",{key:s,attrs:{comment:o},on:{"reply-click":function(e){return t.$emit("reply-click",e)}}})})),1)],1)},h=[],f=function(){var t=this,e=t._self._c;return e("van-cell",{staticClass:"comment-item",attrs:{title:t.comment.content},scopedSlots:t._u([{key:"icon",fn:function(){return[e("van-image",{staticClass:"avatar",attrs:{fit:"cover",round:"",src:t.comment.aut_photo}})]},proxy:!0},{key:"title",fn:function(){return[e("div",{staticClass:"user-name"},[t._v(t._s(t.comment.aut_name))])]},proxy:!0},{key:"label",fn:function(){return[e("p",{staticClass:"comment-content"},[t._v(t._s(t.comment.content))]),e("div",{staticClass:"bottom-info"},[e("div",{staticClass:"publish-date"},[t._v(t._s(t._f("relativeTime")(t.comment.pubdate)))]),e("van-button",{staticClass:"reply-btn",attrs:{round:""},on:{click:function(e){return t.$emit("reply-click",t.comment)}}},[t._v("回复 "+t._s(t.comment.reply_count)+" ")])],1)]},proxy:!0},{key:"right-icon",fn:function(){return[e("van-button",{staticClass:"like-btn",class:{like:t.comment.is_liking},attrs:{icon:t.comment.is_liking?"good-job":"good-job-o",loading:t.btnLoading},on:{click:t.onCommentLike}},[t._v(" "+t._s(t.comment.like_count||"赞"))])]},proxy:!0}])})},v=[],g={name:"CommentItem",props:{comment:{type:Object,default:()=>({})}},data(){return{btnLoading:!1,commentClone:this.comment}},methods:{async onCommentLike(){this.btnLoading=!0;try{this.comment.is_liking?(await(0,l.IY)(this.comment.com_id),this.commentClone.like_count--):(await(0,l._7)(this.comment.com_id),this.commentClone.like_count++),this.commentClone.is_liking=!this.comment.is_liking}catch(t){this.$toast("操作失败，请重试")}setTimeout((()=>{this.btnLoading=!1}),500)}}},_=g,C=(0,m.Z)(_,f,v,!1,null,"cb393cf0",null),y=C.exports,b={name:"CommentList",components:{CommentItem:y},props:{targetId:{type:String,default:""},totalCount:{type:Number,default:0},type:{type:String,default:"a"}},data(){return{list:[],error:!1,loading:!1,finished:!1,offset:null}},methods:{async onLoad(){try{const{data:t}=await(0,l.nr)({type:this.type,source:this.targetId,offset:this.offset,limit:10});this.list.push(...t.data.results),this.$emit("update:totalCount",t.data.total_count),this.loading=!1,t.data.results.length?this.offset=t.data.last_id:this.finished=!0}catch(t){this.error=!0,this.loading=!1}},unshiftComment(t){this.list.unshift(t.new_obj)}}},w=b,k=(0,m.Z)(w,p,h,!1,null,"4b5535fa",null),I=k.exports,S=function(){var t=this,e=t._self._c;return e("div",{staticClass:"collected"},[e("van-icon",{class:{collected:t.value},attrs:{name:t.value?"star":"star-o",loading:t.btnLoading},on:{click:t.onCollect}})],1)},x=[],$={name:"CollectArticle",data(){return{btnLoading:!1}},props:{value:{type:Boolean,default:!0},articleId:{type:String,default:""}},methods:{async onCollect(){this.btnLoading=!0;try{this.value?await(0,l.u1)(this.articleId):await(0,l.$c)(this.articleId),this.$emit("input",!this.value)}catch(t){t.response&&400===t.response.status?this.$toast("你不能关注自己"):this.$toast("操作失败，请重试")}setTimeout((()=>{this.btnLoading=!1}),500)}}},L=$,P=(0,m.Z)(L,S,x,!1,null,"9ba9a578",null),F=P.exports,A=function(){var t=this,e=t._self._c;return e("div",{staticClass:"collected"},[e("van-icon",{class:{collected:1===t.attitude},attrs:{name:1===t.attitude?"good-job":"good-job-o",loading:t.btnLoading},on:{click:t.onCollect}})],1)},R=[],Z={name:"LikeArticle",data(){return{btnLoading:!1}},props:{attitude:{type:Number,default:-1},articleId:{type:String,default:""}},inject:{articleIdPro:{type:String,default:""}},mounted(){console.log(this.articleIdPro,"iniect")},methods:{async onCollect(){this.btnLoading=!0;let t=this.attitude;try{1===this.attitude?(t=-1,await(0,l.nD)(this.articleId)):(t=1,await(0,l.IF)(this.articleId)),this.$emit("update:attitude",t)}catch(e){e.response&&400===e.response.status?this.$toast("你不能关注自己"):this.$toast("操作失败，请重试")}setTimeout((()=>{this.btnLoading=!1}),500)}}},j=Z,T=(0,m.Z)(j,A,R,!1,null,"0e89b65e",null),z=T.exports,B=function(){var t=this,e=t._self._c;return t.isFollowed?e("van-button",{staticClass:"follow-btn",attrs:{type:"info",round:"",size:"small",icon:"plus",loading:t.btnLoading},on:{click:t.onFollow}},[t._v("关注")]):e("van-button",{staticClass:"follow-btn",attrs:{round:"",size:"small",loading:t.btnLoading},on:{click:t.onFollow}},[t._v("已关注")])},D=[],E={name:"FollowUser",model:{prop:"isFollowed",event:"update-follow"},data(){return{btnLoading:!1}},props:{isFollowed:{type:Boolean,default:!0},userId:{type:String,default:""}},methods:{async onFollow(){this.btnLoading=!0;try{this.isFollowed?await(0,l.YE)(this.userId):await(0,l.u5)(this.userId),this.$emit("update:isFollowed",!this.isFollowed)}catch(t){t.response&&400===t.response.status?this.$toast("你不能关注自己"):this.$toast("操作失败，请重试")}setTimeout((()=>{this.btnLoading=!1}),500)}}},N=E,O=(0,m.Z)(N,B,D,!1,null,"37f12766",null),U=O.exports,Y=o(6471),q=function(){var t=this,e=t._self._c;return e("div",{staticClass:"comment-reply"},[e("van-nav-bar",{attrs:{title:t.comment.reply_count>0?`${t.comment.reply_count}条回复`:"暂无回复","left-arrow":"",fixed:""},scopedSlots:t._u([{key:"left",fn:function(){return[e("van-icon",{attrs:{name:"cross"},on:{click:function(e){return t.$emit("close")}}})]},proxy:!0}])}),e("div",{staticClass:"scroll-wrap"},[e("comment-item",{attrs:{comment:t.comment}}),e("van-cell",[t._v("全部回复")]),e("comment-list",{ref:"comment-list",attrs:{targetId:t.comment.com_id,type:"c"}})],1),e("div",{staticClass:"reply-bottom"},[e("van-button",{staticClass:"reply-btn",attrs:{round:"",size:"small"},on:{click:function(e){t.isPostShow=!0}}},[t._v("写评论 ")])],1),e("van-popup",{attrs:{position:"bottom"},model:{value:t.isPostShow,callback:function(e){t.isPostShow=e},expression:"isPostShow"}},[e("comment-post",{attrs:{targetId:t.comment.com_id,articleId:t.$route.params.articleId},on:{"post-success":t.onPostSuccess}})],1)],1)},H=[],M={components:{commentItem:y,CommentList:I,CommentPost:d},name:"CommentReply",props:{comment:{type:Object,default:()=>({})}},data(){return{isPostShow:!1,commentClone:this.comment}},methods:{onPostSuccess(t){this.commentClone.reply_count++,this.isPostShow=!1,this.$refs["comment-list"].unshiftComment(t)}}},G=M,J=(0,m.Z)(G,q,H,!1,null,"116b3cab",null),K=J.exports,Q={name:"ArticleIndex",data(){return{article:{},loading:!0,errStatus:0,isPostShow:!1,totalCommentCount:0,isReplyShow:!1,currentComment:{}}},components:{FollowUser:U,CollectArticle:F,LikeArticle:z,CommentList:I,CommentPost:d,CommentReply:K},props:{articleId:{type:String,default:""}},provide:function(){return{articleIdPro:this.articleId}},created(){this.loadArticleInfo()},methods:{async loadArticleInfo(){this.loading=!0;try{const{data:t}=await(0,l.rk)(this.articleId);console.log(t),this.article=t.data,setTimeout((()=>{this.previewImage()}),0)}catch(t){t.response&&404===t.response.status&&(this.errStatus=404),this.$toast("获取文章失败")}this.loading=!1},previewImage(){const t=this.$refs["article-content"];if(!t)return;const e=t.querySelectorAll("img"),o=[...e].map((t=>t.src));e.forEach(((t,e)=>{t.onclick=()=>{(0,Y.Z)({images:o,startPosition:e})}}))},onPostSuccess(t){this.isPostShow=!1,this.$refs["comment-list"].unshiftComment(t),console.log(t)},onReplyClick(t){this.currentComment=t||{},console.log(t),this.isReplyShow=!0}}},V=Q,W=(0,m.Z)(V,s,n,!1,null,"2d1a6868",null),X=W.exports}}]);
//# sourceMappingURL=657.24a08189.js.map