"use strict";(self["webpackChunktoutiao_m"]=self["webpackChunktoutiao_m"]||[]).push([[832],{8832:function(t,e,s){s.r(e),s.d(e,{default:function(){return b}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"search-container"},[e("form",{attrs:{action:"/"}},[e("van-search",{attrs:{"show-action":"",background:"#3296fa",placeholder:"请输入搜索关键词"},on:{search:t.onSearch,cancel:t.onCancel,focus:function(e){t.isResultShow=!1}},model:{value:t.searchText,callback:function(e){t.searchText=e},expression:"searchText"}})],1),t.isResultShow?e("search-result",{attrs:{searchText:t.searchText}}):t.searchText?e("search-suggestion",{attrs:{searchText:t.searchText},on:{search:t.onSearch}}):e("search-history",{ref:"search-history",attrs:{searchHistories:t.searchHistories},on:{clearAll:function(e){t.searchHistories=[]},clearHistory:t.onClearHistory,search:t.onSearch}})],1)},r=[],i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"search-history"},[e("van-cell",{attrs:{title:"搜索历史"},scopedSlots:t._u([{key:"right-icon",fn:function(){return[t.isDeleteShow?[e("span",{staticStyle:{"margin-right":"5px"},on:{click:t.clearAll}},[t._v("全部删除")]),e("span",[t._v("完成")])]:e("van-icon",{staticClass:"delete-icon",attrs:{name:"delete"},on:{click:function(e){t.isDeleteShow=!0}}})]},proxy:!0}])}),t._l(t.searchHistories,(function(s,a){return e("van-cell",{key:a,attrs:{title:s},on:{click:function(e){return t.onClearHistory(s,a)}},scopedSlots:t._u([t.isDeleteShow?{key:"right-icon",fn:function(){return[e("van-icon",{staticClass:"delete-icon",attrs:{name:"close"}})]},proxy:!0}:null],null,!0)})}))],2)},n=[],o={name:"searchHistory",props:{searchHistories:{type:Array,default:()=>[]}},data(){return{isDeleteShow:!1}},methods:{clearAll(){this.$emit("clearAll")},onClearHistory(t,e){this.isDeleteShow?this.$emit("clearHistory",e):this.$emit("search",t)}}},c=o,l=s(1001),h=(0,l.Z)(c,i,n,!1,null,"689cc362",null),u=h.exports,d=function(){var t=this,e=t._self._c;return e("div",{staticClass:"search-suggestion"},t._l(t.suggestions,(function(s,a){return e("van-cell",{key:a,attrs:{icon:"search"},on:{click:function(e){return t.$emit("search",s)}},scopedSlots:t._u([{key:"title",fn:function(){return[e("span",{attrs:{slot:"title"},domProps:{innerHTML:t._s(t.highlight(s))},slot:"title"})]},proxy:!0}],null,!0)})})),1)},p=[],f=s(432),g=s(4806),S={name:"searchSuggestion",data(){return{suggestions:[]}},props:{searchText:{type:String,default:""}},watch:{searchText:{handler:(0,g.debounce)((function(t){this.loadSearchSuggestion(t)}),200),immediate:!0}},methods:{async loadSearchSuggestion(t){try{const{data:e}=await(0,f.hz)(t);console.log(e),e.data.options&&null===e.data.options[0]&&(e.data.options[0]=this.searchText),this.suggestions=e.data.options}catch{this.$toast("获取失败")}},highlight(t){const e=`<span class="active">${this.searchText}</span>`;return t.split(this.searchText).join(e)}}},x=S,y=(0,l.Z)(x,d,p,!1,null,"eeac837a",null),T=y.exports,_=function(){var t=this,e=t._self._c;return e("div",{staticClass:"search-result"},[e("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了",error:t.error,"error-text":"请求失败，点击重试"},on:{"update:error":function(e){t.error=e},load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(t){return e("van-cell",{key:t.art_id,attrs:{title:t.title}})})),1)],1)},m=[],H={name:"SearchResult",data(){return{list:[],loading:!1,finished:!1,page:1,perPage:20,error:!1}},props:{searchText:{type:String,default:""}},methods:{async onLoad(){try{const{data:t}=await(0,f.Sx)({page:this.page,per_page:this.perPage,q:this.searchText});console.log(t.data.results),this.list.push(...t.data.results),this.loading=!1,t.data.results.length?this.page++:this.finished=!0}catch(t){this.error=!0,this.loading=!1,this.$toast("请求失败，请稍后重试")}}}},v=H,k=(0,l.Z)(v,_,m,!1,null,"4af3fd30",null),w=k.exports,C=s(7247),A={name:"searchIndex",data(){return{searchText:"",isResultShow:!1,searchHistories:(0,C.rV)("TOUTIAO_SEARCH_HISTORY")||[]}},watch:{searchHistories:{handler(t){(0,C.LS)("TOUTIAO_SEARCH_HISTORY",t)},deep:!0}},components:{SearchHistory:u,SearchSuggestion:T,SearchResult:w},methods:{onSearch(t){this.searchText=t,this.isResultShow=!0,this.onAddTarget(t)},onAddTarget(t){const e=this.searchHistories.indexOf(t);-1!==e&&this.searchHistories.splice(e,1),this.searchHistories.unshift(t)},onClearHistory(t){this.searchHistories.splice(t,1)},onCancel(){this.$toast("取消"),this.$router.back()}}},R=A,$=(0,l.Z)(R,a,r,!1,null,"199cb804",null),b=$.exports}}]);
//# sourceMappingURL=832.b5f127c8.js.map